<div class="dashboard-container">
  
  <!-- Header -->
  <div class="header-bar">
    <nav class="navigation-links">
      <h2>Valuations Dashboard</h2>
    </nav>
    <div class="user-info" *ngIf="currentUser">
      ğŸ‘¤ Welcome, <strong>{{ currentUser.name }}</strong>
    </div>
  </div>

  <!-- Filters Section -->
  <div class="filters-section">
    <div class="filter-row">
      <div class="date-filter-wrapper">
        <mat-form-field appearance="outline" class="date-input">
          <mat-label>Filter by Created Date</mat-label>
          <input 
            matInput 
            [matDatepicker]="picker" 
            [(ngModel)]="filterDate" 
            placeholder="Choose a date"
            (dateChange)="onDateFilterChange()">
          <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
          <mat-datepicker #picker></mat-datepicker>
        </mat-form-field>
      </div>
    </div>

    <!-- Only ALL Filter Button -->
    <div class="all-filter">
      <button
        [class.active]="selectedStatus === ''"
        (click)="setStatusFilter('')">
        ğŸ“Š ALL <span *ngIf="claims.length">({{ claims.length }})</span>
      </button>
    </div>

    <!-- Status Filter Buttons -->
    <div class="status-filter">
      <button 
        *ngFor="let status of statuses" 
        [class.active]="selectedStatus === status" 
        (click)="setStatusFilter(status)">
        {{ status }}
      </button>
    </div>
  </div>

  <!-- Loading State -->
  <div *ngIf="loading" class="loading">
    â³ Loading valuationsâ€¦
  </div>

  <!-- Error State -->
  <div *ngIf="!loading && error" class="error">
    âŒ {{ error }}
  </div>

  <!-- Main Content - TABLE -->
  <ng-container *ngIf="!loading && !error">
    
    <!-- Empty State -->
    <div *ngIf="filteredClaims.length === 0" class="empty">
      ğŸ“­ No valuations to display.
    </div>

    <!-- Table Wrapper -->
    <div *ngIf="filteredClaims.length > 0" class="table-wrapper">
      <table 
        mat-table 
        [dataSource]="filteredClaims" 
        class="dashboard-table">

        <!-- Vehicle Number -->
        <ng-container matColumnDef="vehicleNumber">
          <th mat-header-cell *matHeaderCellDef>ğŸš— Vehicle No.</th>
          <td mat-cell *matCellDef="let v">
            <strong>{{ v.vehicleNumber }}</strong>
          </td>
        </ng-container>

        <!-- Assigned To -->
        <ng-container matColumnDef="assignedTo">
          <th mat-header-cell *matHeaderCellDef>ğŸ‘¤ Assigned To</th>
          <td mat-cell *matCellDef="let v">
            {{ v.assignedTo }}
          </td>
        </ng-container>

        <!-- Phone -->
        <ng-container matColumnDef="phone">
          <th mat-header-cell *matHeaderCellDef>ğŸ“± Phone</th>
          <td mat-cell *matCellDef="let v">
            {{ v.assignedToPhoneNumber }}
          </td>
        </ng-container>

        <!-- Location -->
        <ng-container matColumnDef="location">
          <th mat-header-cell *matHeaderCellDef>ğŸ“ Location</th>
          <td mat-cell *matCellDef="let v">
            {{ v.location }}
          </td>
        </ng-container>

        <!-- Created At -->
        <ng-container matColumnDef="createdAt">
          <th mat-header-cell *matHeaderCellDef>ğŸ“… Created</th>
          <td mat-cell *matCellDef="let v">
            {{ v.createdAt | date:'medium' }}
          </td>
        </ng-container>

        <!-- Age -->
        <ng-container matColumnDef="age">
          <th mat-header-cell *matHeaderCellDef>â±ï¸ Days Old</th>
          <td mat-cell *matCellDef="let v"
              [ngClass]="{
                'age-1': ageInDays(v) === 1,
                'age-2': ageInDays(v) === 2,
                'age-3plus': ageInDays(v) >= 3
              }">
            <strong>{{ ageInDays(v) }}</strong>
          </td>
        </ng-container>

        <!-- Red Flag -->
        <ng-container matColumnDef="redFlag">
          <th mat-header-cell *matHeaderCellDef>ğŸš© Flag</th>
          <td mat-cell *matCellDef="let v">
            <span class="red" *ngIf="v.redFlag">âš ï¸ FLAG</span>
            <span *ngIf="!v.redFlag" style="color: var(--gray-300);">-</span>
          </td>
        </ng-container>

        <!-- Applicant -->
        <ng-container matColumnDef="applicant">
          <th mat-header-cell *matHeaderCellDef>ğŸ‘¥ Applicant</th>
          <td mat-cell *matCellDef="let v">
            {{ v.applicantName }}<br>
            <small>{{ v.applicantContact }}</small>
          </td>
        </ng-container>

        <!-- Valuation Info -->
        <ng-container matColumnDef="info">
          <th mat-header-cell *matHeaderCellDef>ğŸ“‹ Valuation</th>
          <td mat-cell *matCellDef="let v">
            <span class="status-badge info">{{ v.valuationType }}</span><br>
            <small>{{ v.name }}</small>
          </td>
        </ng-container>

        <!-- Current Step -->
        <ng-container matColumnDef="currentStep">
          <th mat-header-cell *matHeaderCellDef>ğŸ‘£ Current Step</th>
          <td mat-cell *matCellDef="let v">
            <span class="status-badge success">
              {{ ['Stakeholder', 'BackEnd', 'AVO', 'QC', 'FinalReport'][getStepIndex(v)] }}
            </span>
          </td>
        </ng-container>

        <!-- Status -->
        <ng-container matColumnDef="status">
          <th mat-header-cell *matHeaderCellDef>âœ“ Status</th>
          <td mat-cell *matCellDef="let v">
            <span [ngClass]="{
              'status-badge success': v.status === 'Completed',
              'status-badge warning': v.status === 'In Progress',
              'status-badge error': v.status === 'Rejected'
            }">
              {{ v.status }}
            </span>
          </td>
        </ng-container>

        <!-- Action -->
        <ng-container matColumnDef="action">
          <th mat-header-cell *matHeaderCellDef>âš¡ Action</th>
          <td mat-cell *matCellDef="let v" class="action-cell">
            <button 
              mat-raised-button 
              color="primary" 
              (click)="openCase(v); $event.stopPropagation()"
              class="action-button">
              ğŸ”“ OPEN
            </button>
          </td>
        </ng-container>

        <!-- Header and Rows -->
        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
        <tr mat-row *matRowDef="let v; columns: displayedColumns;"></tr>

      </table>
    </div>

  </ng-container>

</div>
